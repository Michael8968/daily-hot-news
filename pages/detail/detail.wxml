<!--pages/detail/detail.wxml-->
<view class="container {{isDarkMode ? 'dark' : ''}}">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ–°é—»è¯¦æƒ… -->
  <view class="news-detail" wx:elif="{{news}}">
    <!-- æ–°é—»å¤´éƒ¨ -->
    <view class="news-header">
      <text class="news-title">{{news.title}}</text>
      <view class="news-meta">
        <text class="news-source">{{news.source}}</text>
        <text class="news-time">{{news.publishTime}}</text>
        <text class="news-category tag tag-primary">{{news.category}}</text>
      </view>
    </view>

    <!-- æ–°é—»å›¾ç‰‡ -->
    <view class="news-image" wx:if="{{news.image}}">
      <image 
        src="{{news.image}}" 
        mode="aspectFit"
        lazy-load="{{true}}"
        class="image"
      />
    </view>

    <!-- æ–°é—»å†…å®¹ -->
    <view class="news-content">
      <rich-text nodes="{{news.content}}" class="content-text"></rich-text>
    </view>

    <!-- AIæ‘˜è¦ -->
    <view class="summary-section">
      <view class="section-header">
        <text class="section-title">AIæ™ºèƒ½æ‘˜è¦</text>
        <view class="summary-loading" wx:if="{{summaryLoading}}">
          <text>ç”Ÿæˆä¸­...</text>
        </view>
      </view>
      
      <view class="summary-content" wx:if="{{summary}}">
        <text class="summary-text">{{summary}}</text>
      </view>
      
      <view class="summary-placeholder" wx:elif="{{!summaryLoading}}">
        <text class="placeholder-text">ç‚¹å‡»ç”ŸæˆAIæ‘˜è¦</text>
        <button class="btn btn-primary btn-small" bindtap="loadSummary">
          ç”Ÿæˆæ‘˜è¦
        </button>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <view class="action-item" bindtap="toggleLike">
        <text class="action-icon {{isLiked ? 'liked' : ''}}">
          {{isLiked ? 'â¤ï¸' : 'ğŸ¤'}}
        </text>
        <text class="action-text">{{likeCount}}</text>
      </view>
      
      <view class="action-item" bindtap="toggleCollect">
        <text class="action-icon {{isCollected ? 'collected' : ''}}">
          {{isCollected ? 'â­' : 'â˜†'}}
        </text>
        <text class="action-text">æ”¶è—</text>
      </view>
      
      <view class="action-item" bindtap="copyLink">
        <text class="action-icon">ğŸ”—</text>
        <text class="action-text">å¤åˆ¶é“¾æ¥</text>
      </view>
      
      <view class="action-item" bindtap="reportContent">
        <text class="action-icon">âš ï¸</text>
        <text class="action-text">ä¸¾æŠ¥</text>
      </view>
    </view>

    <!-- è¯„è®ºåŒºåŸŸ -->
    <view class="comments-section">
      <view class="section-header">
        <text class="section-title">è¯„è®º ({{comments.length}})</text>
      </view>

      <!-- è¯„è®ºè¾“å…¥ -->
      <view class="comment-input">
        <textarea 
          class="comment-textarea"
          placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
          value="{{commentText}}"
          bindinput="onCommentInput"
          maxlength="500"
          show-confirm-bar="{{false}}"
        />
        <view class="comment-actions">
          <text class="comment-count">{{commentText.length}}/500</text>
          <button 
            class="btn btn-primary btn-small" 
            bindtap="submitComment"
            disabled="{{!commentText.trim()}}"
          >
            å‘å¸ƒ
          </button>
        </view>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view class="comments-list">
        <comment-item 
          wx:for="{{comments}}" 
          wx:key="id"
          comment="{{item}}"
        />
        
        <!-- åŠ è½½æ›´å¤šè¯„è®º -->
        <view class="load-more-comments" wx:if="{{hasMoreComments}}">
          <button 
            class="btn btn-outline" 
            bindtap="loadMoreComments"
            loading="{{commentLoading}}"
          >
            åŠ è½½æ›´å¤šè¯„è®º
          </button>
        </view>
        
        <!-- æ²¡æœ‰æ›´å¤šè¯„è®º -->
        <view class="no-more-comments" wx:elif="{{comments.length > 0}}">
          <text>æ²¡æœ‰æ›´å¤šè¯„è®ºäº†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error" wx:else>
    <view class="error-icon">âŒ</view>
    <text class="error-text">åŠ è½½å¤±è´¥</text>
    <button class="btn btn-primary" bindtap="loadNewsDetail">
      é‡æ–°åŠ è½½
    </button>
  </view>
</view>
