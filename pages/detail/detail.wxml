<!--pages/detail/detail.wxml-->
<view class="container {{isDarkMode ? 'dark' : ''}}">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 新闻详情 -->
  <view class="news-detail" wx:elif="{{news}}">
    <!-- 新闻头部 -->
    <view class="news-header">
      <text class="news-title">{{news.title}}</text>
      <view class="news-meta">
        <text class="news-source">{{news.source}}</text>
        <text class="news-time">{{news.publishTime}}</text>
        <text class="news-category tag tag-primary">{{news.category}}</text>
      </view>
    </view>

    <!-- 新闻图片 -->
    <view class="news-image" wx:if="{{news.image}}">
      <image 
        src="{{news.image}}" 
        mode="aspectFit"
        lazy-load="{{true}}"
        class="image"
      />
    </view>

    <!-- 新闻内容 -->
    <view class="news-content">
      <rich-text nodes="{{news.content}}" class="content-text"></rich-text>
    </view>

    <!-- AI摘要 -->
    <view class="summary-section">
      <view class="section-header">
        <text class="section-title">AI智能摘要</text>
        <view class="summary-loading" wx:if="{{summaryLoading}}">
          <text>生成中...</text>
        </view>
      </view>
      
      <view class="summary-content" wx:if="{{summary}}">
        <text class="summary-text">{{summary}}</text>
      </view>
      
      <view class="summary-placeholder" wx:elif="{{!summaryLoading}}">
        <text class="placeholder-text">点击生成AI摘要</text>
        <button class="btn btn-primary btn-small" bindtap="loadSummary">
          生成摘要
        </button>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <view class="action-item" bindtap="toggleLike">
        <text class="action-icon {{isLiked ? 'liked' : ''}}">
          {{isLiked ? '❤️' : '🤍'}}
        </text>
        <text class="action-text">{{likeCount}}</text>
      </view>
      
      <view class="action-item" bindtap="toggleCollect">
        <text class="action-icon {{isCollected ? 'collected' : ''}}">
          {{isCollected ? '⭐' : '☆'}}
        </text>
        <text class="action-text">收藏</text>
      </view>
      
      <view class="action-item" bindtap="copyLink">
        <text class="action-icon">🔗</text>
        <text class="action-text">复制链接</text>
      </view>
      
      <view class="action-item" bindtap="reportContent">
        <text class="action-icon">⚠️</text>
        <text class="action-text">举报</text>
      </view>
    </view>

    <!-- 评论区域 -->
    <view class="comments-section">
      <view class="section-header">
        <text class="section-title">评论 ({{comments.length}})</text>
      </view>

      <!-- 评论输入 -->
      <view class="comment-input">
        <textarea 
          class="comment-textarea"
          placeholder="写下你的评论..."
          value="{{commentText}}"
          bindinput="onCommentInput"
          maxlength="500"
          show-confirm-bar="{{false}}"
        />
        <view class="comment-actions">
          <text class="comment-count">{{commentText.length}}/500</text>
          <button 
            class="btn btn-primary btn-small" 
            bindtap="submitComment"
            disabled="{{!commentText.trim()}}"
          >
            发布
          </button>
        </view>
      </view>

      <!-- 评论列表 -->
      <view class="comments-list">
        <comment-item 
          wx:for="{{comments}}" 
          wx:key="id"
          comment="{{item}}"
        />
        
        <!-- 加载更多评论 -->
        <view class="load-more-comments" wx:if="{{hasMoreComments}}">
          <button 
            class="btn btn-outline" 
            bindtap="loadMoreComments"
            loading="{{commentLoading}}"
          >
            加载更多评论
          </button>
        </view>
        
        <!-- 没有更多评论 -->
        <view class="no-more-comments" wx:elif="{{comments.length > 0}}">
          <text>没有更多评论了</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 错误状态 -->
  <view class="error" wx:else>
    <view class="error-icon">❌</view>
    <text class="error-text">加载失败</text>
    <button class="btn btn-primary" bindtap="loadNewsDetail">
      重新加载
    </button>
  </view>
</view>
